# Phase E–F: Детальные Work Packages

**Проект:** Meetup Reservation (монорепозиторий)  
**Методология:** TOGAF ADM  
**Версия:** 1.0  
**Зависимости:** [Phase E–F: Migration Plan](./phase-ef-migration-plan.md)

---

## 1. Назначение

Детализация Work Packages для Implementation and Migration Plan. Каждый WP рассчитан на **1–2 часа**.

**Структура WP:** входные артефакты | ожидаемый результат | критерии проверки

**Порядок:** строгая последовательность внутри каждой итерации.

---

## 2. Итерация 0: Фундамент

### WP-0.1 Создание монорепозитория

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.1.1 | Инициализация Git | — | Репозиторий инициализирован | `git status` работает |
| WP-0.1.2 | Структура папок | WP-0.1.1 | Папки `src/backend/`, `src/frontend/`, `src/backend/db/` | Структура соответствует Phase D |
| WP-0.1.3 | .gitignore | WP-0.1.1 | .gitignore для .NET, Node, IDE | bin/, obj/, node_modules/ игнорируются |

### WP-0.2 Backend каркас

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.2.1 | ASP.NET Core Web API проект | WP-0.1.2 | Проект в `src/backend/` | `dotnet run` запускает приложение |
| WP-0.2.2 | Kestrel, Program.cs | WP-0.2.1 | Минимальный API | Приложение слушает порт |
| WP-0.2.3 | CORS (AllowAnyOrigin) | WP-0.2.2 | CORS настроен | Запрос с другого origin не блокируется |
| WP-0.2.4 | appsettings, env | WP-0.2.2 | Конфигурация | Connection string читается из env |
| WP-0.2.5 | Health-check endpoint | WP-0.2.2 | Endpoint для проверки | GET возвращает 200 OK |

### WP-0.3 Схема БД

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.3.1 | SQL: users, user_roles | Phase C Data Model | Скрипты в `src/backend/db/` | Таблицы создаются без ошибок |
| WP-0.3.2 | SQL: organizer_profiles, participant_profiles | WP-0.3.1 | Скрипты | Таблицы создаются |
| WP-0.3.3 | SQL: categories | WP-0.3.1 | Скрипт | Таблица создаётся |
| WP-0.3.4 | SQL: events, event_categories | WP-0.3.1 | Скрипты | Таблицы, FK |
| WP-0.3.5 | SQL: ticket_types, registrations | WP-0.3.4 | Скрипты | UNIQUE(event_id, email) |
| WP-0.3.6 | SQL: event_images, event_attachments | WP-0.3.4 | Скрипты | BLOB (bytea) |
| WP-0.3.7 | Индексы | WP-0.3.1–0.3.6 | Индексы для каталога | Запросы используют индексы |

### WP-0.4 Data Access

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.4.1 | Dapper, connection string | WP-0.2.4, WP-0.3.7 | Пакет Dapper, строка подключения | Подключение к PostgreSQL |
| WP-0.4.2 | Базовый запрос | WP-0.4.1 | Простой SELECT | Данные возвращаются |

### WP-0.5 Скрипт первого администратора

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.5.1 | SQL-скрипт admin | WP-0.3.1 | Скрипт в `src/backend/db/` | Выполнение создаёт пользователя с ролью admin |

*Выполнение скрипта допускается отложить до итерации 3.*

### WP-0.6 Seed-категории

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.6.1 | SQL-скрипт категорий | WP-0.3.3 | Конференции, Вебинары, Концерты и т.п. | Категории в БД |

### WP-0.7 Frontend каркас

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.7.1 | React + Vite проект | WP-0.1.2 | Проект в `src/frontend/` | `npm run dev` запускает |
| WP-0.7.2 | TypeScript | WP-0.7.1 | TS настроен | Компиляция без ошибок |
| WP-0.7.3 | Конфиг API (JSON) | WP-0.7.1 | config.json в src/ | Базовый URL API читается |

### WP-0.8 SMTP для dev

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-0.8.1 | MailKit, настройка | WP-0.2.4 | MailHog/Ethereal в appsettings | Тестовое письмо отправляется |

---

## 3. Итерация 1: Аутентификация и события

### WP-1.1 Auth Module

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-1.1.1 | Регистрация (backend) | WP-0.4.2, Phase C API | POST /api/v1/auth/register, role: organizer \| participant | Регистрация создаёт пользователя и профиль |
| WP-1.1.2 | Argon2id для паролей | WP-1.1.1 | Хеширование паролей | Пароль не хранится в открытом виде |
| WP-1.1.3 | Login, JWT (1 ч) | WP-1.1.2 | POST /api/v1/auth/login | Токен возвращается, Bearer работает |
| WP-1.1.4 | user_roles при регистрации | WP-1.1.1 | Роль записывается в user_roles | Роль organizer/participant сохраняется |

### WP-1.2 Events Module (backend)

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-1.2.1 | POST /events (создание) | WP-1.1.3, Phase C | Создание события организатором | Событие в БД, изоляция по organizer_id |
| WP-1.2.2 | Типы билетов | WP-1.2.1 | ticket_types при создании | Минимум один тип, price, capacity |
| WP-1.2.3 | Категории события | WP-1.2.1, WP-0.6.1 | event_categories M:N | Выбор из seed-категорий |
| WP-1.2.4 | Загрузка изображений (BLOB) | WP-1.2.1 | event_images | Фото сохраняется в bytea |
| WP-1.2.5 | GET /events/{id} | WP-1.2.1 | Детали события | Публичные данные возвращаются |
| WP-1.2.6 | POST /events/{id}/cancel | WP-1.2.1 | Отмена события | status = cancelled |

### WP-1.3 Каталог (backend)

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-1.3.1 | GET /events (список) | WP-1.2.1 | Список публичных событий | cursor-пагинация |
| WP-1.3.2 | Фильтры по категориям | WP-1.3.1 | Параметр categoryIds | Логика OR |
| WP-1.3.3 | Сортировка | WP-1.3.1 | По дате проведения, по дате создания | Параметр sortBy |
| WP-1.3.4 | GET /organizers/{id}/events | WP-1.2.1 | События организатора | Публичный профиль |

### WP-1.4 Frontend: Auth

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-1.4.1 | Страница регистрации | WP-0.7.3 | Форма: email, пароль, role | POST /auth/register |
| WP-1.4.2 | Страница входа | WP-1.4.1 | Форма: email, пароль | POST /auth/login, JWT сохраняется |
| WP-1.4.3 | Хранение JWT | WP-1.4.2 | localStorage/sessionStorage | Токен передаётся в Authorization |

### WP-1.5 Frontend: Каталог

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-1.5.1 | Страница каталога | WP-1.3.1 | Список событий | GET /events |
| WP-1.5.2 | Фильтры, сортировка | WP-1.5.1 | UI фильтров | Параметры передаются в API |
| WP-1.5.3 | Страница события | WP-1.2.5 | Детали события | GET /events/{id} |
| WP-1.5.4 | Пагинация (cursor) | WP-1.5.1 | Кнопка «Далее» | nextCursor используется |

### WP-1.6 Frontend: Кабинет организатора

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-1.6.1 | Форма создания события | WP-1.2.1, WP-1.4.3 | Поля: название, описание, дата, место, категории | POST /events |
| WP-1.6.2 | Типы билетов в форме | WP-1.6.1 | Добавление типов (название, цена, capacity) | Минимум один |
| WP-1.6.3 | Загрузка фото | WP-1.6.1 | Загрузка файла | BLOB в event_images |
| WP-1.6.4 | Публичный профиль организатора | WP-1.2.4 | organizer_profiles: название, описание, аватар | Отображается на странице организатора |

---

## 4. Итерация 2: Регистрация и уведомления

### WP-2.1 Registrations Module

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-2.1.1 | POST /registrations | WP-1.2.2, Phase C | Регистрация на мероприятие | Запись в registrations |
| WP-2.1.2 | Проверка UNIQUE(event_id, email) | WP-2.1.1 | Ошибка при дублировании | 409 или 400 |
| WP-2.1.3 | Ограничение мест | WP-2.1.1 | Проверка capacity | Регистрация закрывается при заполнении |
| WP-2.1.4 | Оплата-заглушка | WP-2.1.1 | Шаг «оплата» для платных билетов | Заглушка, регистрация завершается |
| WP-2.1.5 | Гость vs залогиненный | WP-2.1.1 | user_id null для гостей | participant_profiles для залогиненных |

### WP-2.2 Notifications Module

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-2.2.1 | MailKit интеграция | WP-0.8.1 | Сервис отправки email | Письмо доставляется |
| WP-2.2.2 | Шаблон: подтверждение регистрации | WP-2.1.1 | Письмо участнику | Отправляется после регистрации |
| WP-2.2.3 | Шаблон: напоминание (день/час) | WP-2.2.1 | Письма за 24ч и 1ч | Текст шаблона готов |
| WP-2.2.4 | Шаблон: отмена события | WP-1.2.6 | Письмо при отмене | Участники уведомляются |
| WP-2.2.5 | Шаблон: отмена участником | WP-2.1.1 | Письмо организатору | При отмене регистрации |

### WP-2.3 Фоновые задачи

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-2.3.1 | IHostedService для напоминаний | WP-2.2.3 | Фоновая задача | Напоминания за день отправляются |
| WP-2.3.2 | Напоминание за час | WP-2.3.1 | За 1 ч до события | Оба напоминания работают |

### WP-2.4 Frontend: Регистрация на мероприятие

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-2.4.1 | Форма регистрации | WP-2.1.1 | Выбор билета, ввод данных | POST /registrations |
| WP-2.4.2 | Автозаполнение для залогиненных | WP-2.4.1, WP-1.4.3 | Данные из participant_profiles | ФИО, email, телефон |
| WP-2.4.3 | Шаг оплаты (заглушка) | WP-2.4.1 | Для платных билетов | Пропуск для бесплатных |
| WP-2.4.4 | Сообщение об успехе | WP-2.4.1 | Подтверждение регистрации | Email будет отправлен |

### WP-2.5 Frontend: Личный кабинет участника

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-2.5.1 | GET /me/registrations | WP-2.1.1 | «Мои регистрации» | Список для залогиненного |
| WP-2.5.2 | Отмена своей регистрации | WP-2.5.1 | DELETE /registrations/{id} | С подтверждением |
| WP-2.5.3 | Уведомление организатору | WP-2.5.2 | Email при отмене | FR-07.4 |

---

## 5. Итерация 3: Управление и администрирование

### WP-3.1 Чек-ин и отмена

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-3.1.1 | PATCH /registrations/{id}/check-in | WP-2.1.1 | Ручная отметка | checked_in_at заполняется |
| WP-3.1.2 | DELETE /registrations/{id} (организатором) | WP-2.1.1 | Отмена регистрации | status = cancelled |
| WP-3.1.3 | GET /events/{id}/registrations | WP-2.1.1 | Список участников | Только для организатора |

### WP-3.2 Export Module

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-3.2.1 | ClosedXML (Excel) | WP-3.1.3 | GET /export?format=xlsx | Файл Excel |
| WP-3.2.2 | PdfSharp (PDF) | WP-3.1.3 | GET /export?format=pdf | Файл PDF |
| WP-3.2.3 | Колонки: ФИО, email, телефон, чек-ин | WP-3.2.1 | Соответствие FR-05.4 | Все поля в экспорте |

### WP-3.3 Admin Module

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-3.3.1 | Блокировка/разблокировка события | WP-1.2.1 | PATCH /admin/events/{id}/block, unblock | status = blocked |
| WP-3.3.2 | Блокировка/разблокировка организатора | WP-1.1.1 | PATCH /admin/organizers/{id}/block, unblock | События отменяются, уведомления |
| WP-3.3.3 | Блокировка/разблокировка пользователя | WP-1.1.1 | PATCH /admin/users/{id}/block, unblock | is_blocked, регистрации аннулируются |
| WP-3.3.4 | GET /admin/users | WP-3.3.3 | Список пользователей | Только для admin |
| WP-3.3.5 | CRUD категорий | WP-0.6.1 | GET/POST/PATCH /admin/categories | Добавление, редактирование, is_archived |

### WP-3.4 Frontend: Управление участниками

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-3.4.1 | Список участников | WP-3.1.3 | Таблица участников | ФИО, email, статус чек-ина |
| WP-3.4.2 | Кнопка чек-ин | WP-3.4.1 | PATCH check-in | Отметка отображается |
| WP-3.4.3 | Кнопка отмены регистрации | WP-3.4.1 | DELETE registration | Участник удаляется из списка |
| WP-3.4.4 | Кнопка экспорт Excel/PDF | WP-3.2.1 | Скачивание файла | Оба формата |

### WP-3.5 Frontend: Админ-панель

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-3.5.1 | Раздел модерации событий | WP-3.3.1 | Блокировка/разблокировка | Доступно только admin |
| WP-3.5.2 | Раздел пользователей | WP-3.3.4 | Список, блокировка | Управление пользователями |
| WP-3.5.3 | Раздел категорий | WP-3.3.5 | CRUD категорий | Добавление, архив |

---

## 6. Итерация 4: Интеграция и развёртывание

### WP-4.1 Раздача статики

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-4.1.1 | Kestrel UseStaticFiles | WP-0.7.3 | SPA отдаётся backend | Статика по корневому пути |
| WP-4.1.2 | Альтернатива: Nginx/Caddy | WP-4.1.1 | Конфиг reverse proxy | Документирована опция |

### WP-4.2 Production конфигурация

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-4.2.1 | Переменные окружения | Phase D TR-08 | Connection string, SMTP | Читаются из env |
| WP-4.2.2 | JWT в конфиге (v1) | WP-1.1.3 | Секретный ключ в appsettings | Токены подписываются |
| WP-4.2.3 | Frontend config для production | WP-0.7.3 | API URL для production | Сборка с правильным URL |

### WP-4.3 Выбор варианта развёртывания

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-4.3.1 | Решение: VM / Cloud / SaaS | Phase D раздел 4 | Вариант выбран | Задокументировано |

### WP-4.4 Ручное тестирование

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-4.4.1 | Чек-лист FR-01–FR-09 | Phase B | Проверка сценариев | Все сценарии пройдены |
| WP-4.4.2 | Исправление дефектов | WP-4.4.1 | Критичные дефекты исправлены | Система стабильна |

### WP-4.5 Документация

| ID | Название | Входные артефакты | Ожидаемый результат | Критерии проверки |
|----|----------|-------------------|---------------------|-------------------|
| WP-4.5.1 | README | — | Описание проекта, запуск | Разработчик может запустить |
| WP-4.5.2 | Инструкция по развёртыванию | WP-4.3.1 | Шаги для production | Развёртывание воспроизводимо |

---

*Документ является приложением к [Phase E–F: Migration Plan](./phase-ef-migration-plan.md).*
